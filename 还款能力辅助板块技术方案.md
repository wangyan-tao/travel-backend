# 还款能力辅助板块技术方案文档

## 1. 概述

### 1.1 功能描述
还款能力辅助板块旨在为大学生提供贷款资质加分项，通过两类路径（实践创收路径和学业资质路径）助力提升贷款审批通过率、拉高授信额度。该板块包含三个核心功能模块：
- 兼职商铺&就业单位推荐（实践创收路径）
- 学业荣誉证明上传（学业资质路径）
- 资质档案管理

### 1.2 技术栈
- **后端框架**: Spring Boot 2.x / 3.x
- **数据库**: MySQL
- **ORM框架**: MyBatis-Plus
- **文件存储**: OSS (阿里云/腾讯云)
- **API文档**: Swagger/OpenAPI 3.0

## 2. 数据库设计

### 2.1 现有表结构（已存在）

#### 2.1.1 part_time_job（兼职商铺表）
```sql
CREATE TABLE `part_time_job` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '商铺ID',
  `job_title` VARCHAR(100) NOT NULL COMMENT '岗位名称',
  `company_name` VARCHAR(200) NOT NULL COMMENT '商铺/公司名称',
  `city` VARCHAR(50) NOT NULL COMMENT '所在城市',
  `district` VARCHAR(50) COMMENT '所在区域',
  `address` VARCHAR(500) COMMENT '详细地址',
  `salary_range` VARCHAR(50) COMMENT '薪资范围',
  `job_type` VARCHAR(50) NOT NULL COMMENT '岗位类型：餐饮服务/文创店铺/超市导购/短期实习/其他',
  `contact_phone` VARCHAR(20) NOT NULL COMMENT '联系电话',
  `description` TEXT COMMENT '岗位描述',
  `status` VARCHAR(20) DEFAULT 'ACTIVE' COMMENT '状态：ACTIVE-上架, INACTIVE-下架',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_city_district` (`city`, `district`),
  INDEX `idx_job_type` (`job_type`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='兼职商铺表';
```

#### 2.1.2 user_job_proof（用户兼职证明表）
```sql
CREATE TABLE `user_job_proof` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '证明ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `job_id` BIGINT COMMENT '关联兼职ID',
  `proof_type` VARCHAR(50) NOT NULL COMMENT '证明类型：工作证明/工资流水/劳动合同',
  `proof_url` VARCHAR(500) NOT NULL COMMENT '证明材料URL',
  `monthly_income` DECIMAL(10,2) COMMENT '月收入',
  `start_date` DATE NOT NULL COMMENT '开始日期',
  `end_date` DATE COMMENT '结束日期',
  `verification_status` VARCHAR(20) DEFAULT 'PENDING' COMMENT '核验状态：PENDING-待核验, VERIFIED-已核验, FAILED-核验失败',
  `remarks` TEXT COMMENT '备注说明',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_job_id` (`job_id`),
  INDEX `idx_verification_status` (`verification_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户兼职证明表';
```

#### 2.1.3 academic_honor（学业荣誉证明表）
```sql
CREATE TABLE `academic_honor` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '证明ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `honor_type` VARCHAR(50) NOT NULL COMMENT '证明类型：奖学金/竞赛获奖/优秀学生/科研成果/社会实践',
  `honor_name` VARCHAR(200) NOT NULL COMMENT '荣誉名称',
  `award_level` VARCHAR(50) NOT NULL COMMENT '获奖级别：国家级/省级/校级/院级',
  `award_date` DATE NOT NULL COMMENT '获奖日期',
  `certificate_url` VARCHAR(500) NOT NULL COMMENT '证书URL',
  `issuing_organization` VARCHAR(200) COMMENT '颁发机构',
  `verification_status` VARCHAR(20) DEFAULT 'PENDING' COMMENT '核验状态：PENDING-待核验, VERIFIED-已核验, FAILED-核验失败',
  `remarks` TEXT COMMENT '备注说明',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_honor_type` (`honor_type`),
  INDEX `idx_verification_status` (`verification_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学业荣誉证明表';
```

#### 2.1.4 user_location（用户位置信息表）
```sql
CREATE TABLE `user_location` (
  `id` BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `current_city` VARCHAR(50) COMMENT '当前所在城市',
  `school_city` VARCHAR(50) COMMENT '学校所在城市',
  `latitude` DECIMAL(10,7) COMMENT '纬度',
  `longitude` DECIMAL(10,7) COMMENT '经度',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户位置信息表';
```

### 2.2 表结构优化建议

#### 2.2.1 添加 remarks 字段
需要在 `user_job_proof` 和 `academic_honor` 表中添加 `remarks` 字段（如果不存在）：
```sql
ALTER TABLE `user_job_proof` ADD COLUMN `remarks` TEXT COMMENT '备注说明' AFTER `end_date`;
ALTER TABLE `academic_honor` ADD COLUMN `remarks` TEXT COMMENT '备注说明' AFTER `issuing_organization`;
```

## 3. 后端API设计

### 3.1 兼职推荐相关API

#### 3.1.1 获取兼职推荐列表
**接口路径**: `GET /api/jobs/recommendations`

**请求参数**:
```json
{
  "city": "北京市",           // 可选，城市名称
  "district": "海淀区",       // 可选，区域名称
  "jobType": "餐饮服务",      // 可选，岗位类型
  "status": "ACTIVE"         // 可选，状态，默认ACTIVE
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "jobTitle": "餐厅服务员",
      "companyName": "XX连锁餐厅",
      "city": "北京市",
      "district": "海淀区",
      "address": "XX路XX号",
      "salaryRange": "3000-5000元/月",
      "jobType": "餐饮服务",
      "contactPhone": "13800138000",
      "description": "负责餐厅日常服务工作...",
      "status": "ACTIVE",
      "createdAt": "2024-01-01 10:00:00",
      "updatedAt": "2024-01-01 10:00:00"
    }
  ],
  "timestamp": 1704067200000
}
```

#### 3.1.2 上传工作证明
**接口路径**: `POST /api/jobs/proof`

**请求体**:
```json
{
  "jobId": 1,                    // 可选，关联的兼职ID
  "proofType": "工作证明",        // 必填：工作证明/工资流水/劳动合同
  "proofUrl": "https://...",      // 必填，文件上传后的URL
  "monthlyIncome": 4500.00,      // 可选，月收入
  "startDate": "2024-01-01",     // 必填，开始日期
  "endDate": "2024-06-30",       // 可选，结束日期
  "remarks": "备注信息"           // 可选，备注说明
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "工作证明上传成功",
  "data": {
    "id": 1,
    "userId": 100,
    "jobId": 1,
    "proofType": "工作证明",
    "proofUrl": "https://...",
    "monthlyIncome": 4500.00,
    "startDate": "2024-01-01",
    "endDate": "2024-06-30",
    "verificationStatus": "PENDING",
    "remarks": "备注信息",
    "createdAt": "2024-01-15 10:00:00"
  },
  "timestamp": 1704067200000
}
```

#### 3.1.3 获取用户工作证明列表
**接口路径**: `GET /api/jobs/proof`

**响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "jobId": 1,
      "jobTitle": "餐厅服务员",      // 关联查询返回
      "companyName": "XX连锁餐厅",    // 关联查询返回
      "proofType": "工作证明",
      "proofUrl": "https://...",
      "monthlyIncome": 4500.00,
      "startDate": "2024-01-01",
      "endDate": "2024-06-30",
      "verificationStatus": "VERIFIED",
      "remarks": "备注信息",
      "createdAt": "2024-01-15 10:00:00"
    }
  ],
  "timestamp": 1704067200000
}
```

#### 3.1.4 删除工作证明
**接口路径**: `DELETE /api/jobs/proof/{id}`

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null,
  "timestamp": 1704067200000
}
```

### 3.2 学业荣誉相关API

#### 3.2.1 上传学业荣誉证明
**接口路径**: `POST /api/academic-honors`

**请求体**:
```json
{
  "honorType": "奖学金",              // 必填：奖学金/竞赛获奖/优秀学生/科研成果/社会实践
  "honorName": "国家励志奖学金",       // 必填，荣誉名称
  "awardLevel": "国家级",              // 必填：国家级/省级/校级/院级
  "awardDate": "2024-01-01",          // 必填，获奖日期
  "certificateUrl": "https://...",     // 必填，证书文件URL
  "issuingOrganization": "教育部",     // 可选，颁发机构
  "remarks": "备注信息"                // 可选，备注说明
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "学业荣誉上传成功",
  "data": {
    "id": 1,
    "userId": 100,
    "honorType": "奖学金",
    "honorName": "国家励志奖学金",
    "awardLevel": "国家级",
    "awardDate": "2024-01-01",
    "certificateUrl": "https://...",
    "issuingOrganization": "教育部",
    "verificationStatus": "PENDING",
    "remarks": "备注信息",
    "createdAt": "2024-01-15 10:00:00"
  },
  "timestamp": 1704067200000
}
```

#### 3.2.2 获取用户学业荣誉列表
**接口路径**: `GET /api/academic-honors`

**响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "honorType": "奖学金",
      "honorName": "国家励志奖学金",
      "awardLevel": "国家级",
      "awardDate": "2024-01-01",
      "certificateUrl": "https://...",
      "issuingOrganization": "教育部",
      "verificationStatus": "VERIFIED",
      "remarks": "备注信息",
      "createdAt": "2024-01-15 10:00:00",
      "updatedAt": "2024-01-16 10:00:00"
    }
  ],
  "timestamp": 1704067200000
}
```

#### 3.2.3 删除学业荣誉
**接口路径**: `DELETE /api/academic-honors/{id}`

**响应示例**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null,
  "timestamp": 1704067200000
}
```

### 3.3 用户位置相关API

#### 3.3.1 获取用户位置信息
**接口路径**: `GET /api/user/location`

**响应示例**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "userId": 100,
    "currentCity": "北京市",
    "schoolCity": "北京市",
    "latitude": 39.9042,
    "longitude": 116.4074,
    "createdAt": "2024-01-01 10:00:00",
    "updatedAt": "2024-01-01 10:00:00"
  },
  "timestamp": 1704067200000
}
```

## 4. 后端实现方案

### 4.1 Controller层实现

#### 4.1.1 JobRecommendationController.java
```java
package com.qingchun.travelloan.controller;

import com.qingchun.travelloan.entity.PartTimeJob;
import com.qingchun.travelloan.entity.UserJobProof;
import com.qingchun.travelloan.service.JobRecommendationService;
import com.qingchun.travelloan.vo.Result;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;
import java.util.Map;

/**
 * 兼职推荐控制器
 * 
 * @author Qingchun Team
 */
@Tag(name = "兼职推荐管理", description = "兼职推荐和工作证明相关接口")
@RestController
@RequestMapping("/jobs")
public class JobRecommendationController {

    @Autowired
    private JobRecommendationService jobRecommendationService;

    /**
     * 获取兼职推荐列表
     */
    @Operation(summary = "获取兼职推荐列表")
    @GetMapping("/recommendations")
    public Result<List<PartTimeJob>> getRecommendations(
            @RequestParam(required = false) String city,
            @RequestParam(required = false) String district,
            @RequestParam(required = false) String jobType,
            @RequestParam(defaultValue = "ACTIVE") String status,
            Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        List<PartTimeJob> jobs = jobRecommendationService.getRecommendations(userId, city, district, jobType, status);
        return Result.success(jobs);
    }

    /**
     * 上传工作证明
     */
    @Operation(summary = "上传工作证明")
    @PostMapping("/proof")
    public Result<UserJobProof> uploadJobProof(
            @Valid @RequestBody Map<String, Object> request,
            Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        UserJobProof proof = jobRecommendationService.uploadJobProof(userId, request);
        return Result.success("工作证明上传成功", proof);
    }

    /**
     * 获取用户工作证明列表
     */
    @Operation(summary = "获取用户工作证明列表")
    @GetMapping("/proof")
    public Result<List<UserJobProof>> getUserJobProofs(Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        List<UserJobProof> proofs = jobRecommendationService.getUserJobProofs(userId);
        return Result.success(proofs);
    }

    /**
     * 删除工作证明
     */
    @Operation(summary = "删除工作证明")
    @DeleteMapping("/proof/{id}")
    public Result<Void> deleteJobProof(
            @PathVariable Long id,
            Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        jobRecommendationService.deleteJobProof(userId, id);
        return Result.success("删除成功");
    }
}
```

#### 4.1.2 AcademicHonorController.java
```java
package com.qingchun.travelloan.controller;

import com.qingchun.travelloan.entity.AcademicHonor;
import com.qingchun.travelloan.service.AcademicHonorService;
import com.qingchun.travelloan.vo.Result;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import java.util.List;
import java.util.Map;

/**
 * 学业荣誉控制器
 * 
 * @author Qingchun Team
 */
@Tag(name = "学业荣誉管理", description = "学业荣誉证明相关接口")
@RestController
@RequestMapping("/academic-honors")
public class AcademicHonorController {

    @Autowired
    private AcademicHonorService academicHonorService;

    /**
     * 上传学业荣誉证明
     */
    @Operation(summary = "上传学业荣誉证明")
    @PostMapping
    public Result<AcademicHonor> uploadHonor(
            @Valid @RequestBody Map<String, Object> request,
            Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        AcademicHonor honor = academicHonorService.uploadHonor(userId, request);
        return Result.success("学业荣誉上传成功", honor);
    }

    /**
     * 获取用户学业荣誉列表
     */
    @Operation(summary = "获取用户学业荣誉列表")
    @GetMapping
    public Result<List<AcademicHonor>> getUserHonors(Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        List<AcademicHonor> honors = academicHonorService.getUserHonors(userId);
        return Result.success(honors);
    }

    /**
     * 删除学业荣誉
     */
    @Operation(summary = "删除学业荣誉")
    @DeleteMapping("/{id}")
    public Result<Void> deleteHonor(
            @PathVariable Long id,
            Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        academicHonorService.deleteHonor(userId, id);
        return Result.success("删除成功");
    }
}
```

#### 4.1.3 UserLocationController.java
```java
package com.qingchun.travelloan.controller;

import com.qingchun.travelloan.entity.UserLocation;
import com.qingchun.travelloan.service.UserLocationService;
import com.qingchun.travelloan.vo.Result;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.*;

/**
 * 用户位置控制器
 * 
 * @author Qingchun Team
 */
@Tag(name = "用户位置管理", description = "用户位置信息相关接口")
@RestController
@RequestMapping("/user/location")
public class UserLocationController {

    @Autowired
    private UserLocationService userLocationService;

    /**
     * 获取用户位置信息
     */
    @Operation(summary = "获取用户位置信息")
    @GetMapping
    public Result<UserLocation> getUserLocation(Authentication authentication) {
        Long userId = (Long) authentication.getPrincipal();
        UserLocation location = userLocationService.getUserLocation(userId);
        return Result.success(location);
    }
}
```

### 4.2 Service层实现

#### 4.2.1 JobRecommendationService.java
```java
package com.qingchun.travelloan.service;

import com.qingchun.travelloan.entity.PartTimeJob;
import com.qingchun.travelloan.entity.UserJobProof;
import com.qingchun.travelloan.entity.UserLocation;
import com.qingchun.travelloan.exception.BusinessException;
import com.qingchun.travelloan.mapper.PartTimeJobMapper;
import com.qingchun.travelloan.mapper.UserJobProofMapper;
import com.qingchun.travelloan.mapper.UserLocationMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.util.List;
import java.util.Map;

/**
 * 兼职推荐服务
 * 
 * @author Qingchun Team
 */
@Service
public class JobRecommendationService {

    @Autowired
    private PartTimeJobMapper partTimeJobMapper;

    @Autowired
    private UserJobProofMapper userJobProofMapper;

    @Autowired
    private UserLocationMapper userLocationMapper;

    /**
     * 获取兼职推荐列表
     * 优先使用用户位置信息，如果没有则使用传入的参数
     */
    public List<PartTimeJob> getRecommendations(Long userId, String city, String district, String jobType, String status) {
        // 如果未传入城市，尝试从用户位置信息获取
        if (city == null || city.isEmpty()) {
            UserLocation location = userLocationMapper.selectByUserId(userId);
            if (location != null) {
                city = location.getCurrentCity() != null ? location.getCurrentCity() : location.getSchoolCity();
            }
        }

        // 构建查询条件
        Map<String, Object> params = new HashMap<>();
        if (city != null && !city.isEmpty()) {
            params.put("city", city);
        }
        if (district != null && !district.isEmpty()) {
            params.put("district", district);
        }
        if (jobType != null && !jobType.isEmpty()) {
            params.put("jobType", jobType);
        }
        params.put("status", status);

        return partTimeJobMapper.selectByConditions(params);
    }

    /**
     * 上传工作证明
     */
    @Transactional
    public UserJobProof uploadJobProof(Long userId, Map<String, Object> request) {
        UserJobProof proof = new UserJobProof();
        proof.setUserId(userId);
        
        if (request.get("jobId") != null) {
            proof.setJobId(Long.valueOf(request.get("jobId").toString()));
        }
        proof.setProofType(request.get("proofType").toString());
        proof.setProofUrl(request.get("proofUrl").toString());
        
        if (request.get("monthlyIncome") != null) {
            proof.setMonthlyIncome(new BigDecimal(request.get("monthlyIncome").toString()));
        }
        
        proof.setStartDate(LocalDate.parse(request.get("startDate").toString()));
        
        if (request.get("endDate") != null) {
            proof.setEndDate(LocalDate.parse(request.get("endDate").toString()));
        }
        
        if (request.get("remarks") != null) {
            proof.setRemarks(request.get("remarks").toString());
        }
        
        proof.setVerificationStatus("PENDING");
        
        userJobProofMapper.insert(proof);
        return proof;
    }

    /**
     * 获取用户工作证明列表（包含关联的兼职信息）
     */
    public List<UserJobProof> getUserJobProofs(Long userId) {
        return userJobProofMapper.selectByUserIdWithJobInfo(userId);
    }

    /**
     * 删除工作证明
     */
    @Transactional
    public void deleteJobProof(Long userId, Long proofId) {
        UserJobProof proof = userJobProofMapper.selectById(proofId);
        if (proof == null) {
            throw new BusinessException("工作证明不存在");
        }
        if (!proof.getUserId().equals(userId)) {
            throw new BusinessException("无权删除此工作证明");
        }
        userJobProofMapper.deleteById(proofId);
    }
}
```

#### 4.2.2 AcademicHonorService.java
```java
package com.qingchun.travelloan.service;

import com.qingchun.travelloan.entity.AcademicHonor;
import com.qingchun.travelloan.exception.BusinessException;
import com.qingchun.travelloan.mapper.AcademicHonorMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.util.List;
import java.util.Map;

/**
 * 学业荣誉服务
 * 
 * @author Qingchun Team
 */
@Service
public class AcademicHonorService {

    @Autowired
    private AcademicHonorMapper academicHonorMapper;

    /**
     * 上传学业荣誉证明
     */
    @Transactional
    public AcademicHonor uploadHonor(Long userId, Map<String, Object> request) {
        AcademicHonor honor = new AcademicHonor();
        honor.setUserId(userId);
        honor.setHonorType(request.get("honorType").toString());
        honor.setHonorName(request.get("honorName").toString());
        honor.setAwardLevel(request.get("awardLevel").toString());
        honor.setAwardDate(LocalDate.parse(request.get("awardDate").toString()));
        honor.setCertificateUrl(request.get("certificateUrl").toString());
        
        if (request.get("issuingOrganization") != null) {
            honor.setIssuingOrganization(request.get("issuingOrganization").toString());
        }
        
        if (request.get("remarks") != null) {
            honor.setRemarks(request.get("remarks").toString());
        }
        
        honor.setVerificationStatus("PENDING");
        
        academicHonorMapper.insert(honor);
        return honor;
    }

    /**
     * 获取用户学业荣誉列表
     */
    public List<AcademicHonor> getUserHonors(Long userId) {
        return academicHonorMapper.selectByUserId(userId);
    }

    /**
     * 删除学业荣誉
     */
    @Transactional
    public void deleteHonor(Long userId, Long honorId) {
        AcademicHonor honor = academicHonorMapper.selectById(honorId);
        if (honor == null) {
            throw new BusinessException("学业荣誉不存在");
        }
        if (!honor.getUserId().equals(userId)) {
            throw new BusinessException("无权删除此学业荣誉");
        }
        academicHonorMapper.deleteById(honorId);
    }
}
```

#### 4.2.3 UserLocationService.java
```java
package com.qingchun.travelloan.service;

import com.qingchun.travelloan.entity.UserLocation;
import com.qingchun.travelloan.mapper.UserLocationMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * 用户位置服务
 * 
 * @author Qingchun Team
 */
@Service
public class UserLocationService {

    @Autowired
    private UserLocationMapper userLocationMapper;

    /**
     * 获取用户位置信息
     */
    public UserLocation getUserLocation(Long userId) {
        return userLocationMapper.selectByUserId(userId);
    }
}
```

### 4.3 Mapper层实现

#### 4.3.1 PartTimeJobMapper.java（需要添加方法）
```java
package com.qingchun.travelloan.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.qingchun.travelloan.entity.PartTimeJob;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;
import java.util.Map;

/**
 * 兼职商铺Mapper
 * 
 * @author Qingchun Team
 */
@Mapper
public interface PartTimeJobMapper extends BaseMapper<PartTimeJob> {
    
    /**
     * 根据条件查询兼职列表
     */
    List<PartTimeJob> selectByConditions(@Param("params") Map<String, Object> params);
}
```

对应的 XML 映射文件 `PartTimeJobMapper.xml`:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qingchun.travelloan.mapper.PartTimeJobMapper">
    
    <select id="selectByConditions" resultType="com.qingchun.travelloan.entity.PartTimeJob">
        SELECT * FROM part_time_job
        <where>
            <if test="params.status != null and params.status != ''">
                AND status = #{params.status}
            </if>
            <if test="params.city != null and params.city != ''">
                AND city = #{params.city}
            </if>
            <if test="params.district != null and params.district != ''">
                AND district = #{params.district}
            </if>
            <if test="params.jobType != null and params.jobType != ''">
                AND job_type = #{params.jobType}
            </if>
        </where>
        ORDER BY created_at DESC
    </select>
    
</mapper>
```

#### 4.3.2 UserJobProofMapper.java（需要添加方法）
```java
package com.qingchun.travelloan.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.qingchun.travelloan.entity.UserJobProof;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

import java.util.List;

/**
 * 用户兼职证明Mapper
 * 
 * @author Qingchun Team
 */
@Mapper
public interface UserJobProofMapper extends BaseMapper<UserJobProof> {
    
    /**
     * 根据用户ID查询工作证明列表（包含关联的兼职信息）
     */
    List<UserJobProof> selectByUserIdWithJobInfo(@Param("userId") Long userId);
}
```

对应的 XML 映射文件 `UserJobProofMapper.xml`:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qingchun.travelloan.mapper.UserJobProofMapper">
    
    <resultMap id="JobProofWithJobInfo" type="com.qingchun.travelloan.entity.UserJobProof">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="jobId" column="job_id"/>
        <result property="proofType" column="proof_type"/>
        <result property="proofUrl" column="proof_url"/>
        <result property="monthlyIncome" column="monthly_income"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="verificationStatus" column="verification_status"/>
        <result property="remarks" column="remarks"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <association property="jobTitle" column="job_id" select="selectJobTitle"/>
        <association property="companyName" column="job_id" select="selectCompanyName"/>
    </resultMap>
    
    <select id="selectByUserIdWithJobInfo" resultMap="JobProofWithJobInfo">
        SELECT ujp.*, pj.job_title, pj.company_name
        FROM user_job_proof ujp
        LEFT JOIN part_time_job pj ON ujp.job_id = pj.id
        WHERE ujp.user_id = #{userId}
        ORDER BY ujp.created_at DESC
    </select>
    
    <select id="selectJobTitle" resultType="String">
        SELECT job_title FROM part_time_job WHERE id = #{jobId}
    </select>
    
    <select id="selectCompanyName" resultType="String">
        SELECT company_name FROM part_time_job WHERE id = #{jobId}
    </select>
    
</mapper>
```

#### 4.3.3 UserLocationMapper.java（需要添加方法）
```java
package com.qingchun.travelloan.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.qingchun.travelloan.entity.UserLocation;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

/**
 * 用户位置Mapper
 * 
 * @author Qingchun Team
 */
@Mapper
public interface UserLocationMapper extends BaseMapper<UserLocation> {
    
    /**
     * 根据用户ID查询位置信息
     */
    UserLocation selectByUserId(@Param("userId") Long userId);
}
```

对应的 XML 映射文件 `UserLocationMapper.xml`:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qingchun.travelloan.mapper.UserLocationMapper">
    
    <select id="selectByUserId" resultType="com.qingchun.travelloan.entity.UserLocation">
        SELECT * FROM user_location
        WHERE user_id = #{userId}
        LIMIT 1
    </select>
    
</mapper>
```

## 5. 文件上传处理

### 5.1 文件上传接口
文件上传功能应使用现有的 `UploadController`，支持图片和PDF格式，文件大小限制为10MB。

**接口路径**: `POST /api/upload`

**响应格式**:
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "url": "https://oss.example.com/files/xxx.jpg"
  },
  "timestamp": 1704067200000
}
```

## 6. 安全与权限控制

### 6.1 认证要求
所有API接口都需要JWT认证，通过 `Authentication` 参数获取当前用户ID。

### 6.2 权限验证
- 用户只能查看和操作自己的数据
- 删除操作需要验证数据归属权
- 兼职推荐列表对所有认证用户开放

## 7. 业务逻辑说明

### 7.1 兼职推荐逻辑
1. 优先使用用户注册时填写的城市信息（`user_location` 表）
2. 如果用户未设置位置信息，则使用请求参数中的城市
3. 根据城市、区域、岗位类型进行筛选
4. 只返回状态为 `ACTIVE` 的兼职岗位

### 7.2 资质档案复用逻辑
1. 用户上传的工作证明和学业荣誉自动保存到资质档案
2. 在申请贷款时，系统自动关联用户的资质档案
3. 用户可以在资质档案管理中查看、下载、删除档案
4. 已核验的档案在后续申请中可直接复用

### 7.3 核验状态说明
- **PENDING（待核验）**: 用户刚上传，等待系统或人工核验
- **VERIFIED（已核验）**: 核验通过，可以作为贷款审批的加分项
- **FAILED（核验失败）**: 核验未通过，需要用户重新上传

## 8. 性能优化建议

### 8.1 数据库优化
1. 为常用查询字段添加索引（city, district, job_type, user_id等）
2. 使用分页查询，避免一次性加载大量数据
3. 对兼职推荐列表进行缓存（Redis）

### 8.2 接口优化
1. 使用异步处理文件上传和核验
2. 图片和PDF文件使用CDN加速
3. 批量查询时使用关联查询减少数据库访问次数

## 9. 测试建议

### 9.1 单元测试
- Service层业务逻辑测试
- Mapper层数据访问测试

### 9.2 集成测试
- Controller层API接口测试
- 文件上传功能测试
- 权限验证测试

### 9.3 性能测试
- 并发上传测试
- 大量数据查询性能测试

## 10. 部署注意事项

1. 确保OSS配置正确，文件上传功能正常
2. 数据库表结构已创建或更新
3. 添加必要的索引以提升查询性能
4. 配置日志记录，便于问题排查
5. 设置合理的文件大小限制和超时时间

## 11. 后续扩展建议

1. **智能推荐算法**: 基于用户历史行为和偏好推荐更合适的兼职岗位
2. **核验自动化**: 使用OCR技术自动识别证书信息，减少人工核验工作量
3. **资质评分系统**: 根据用户上传的资质档案计算资质评分，用于贷款审批
4. **消息通知**: 核验状态变更时通知用户
5. **数据统计**: 提供资质档案使用情况统计，帮助用户了解自己的资质提升情况

