# 还款能力辅助板块接口说明

## 已完成的修复

### 1. 实体类修复
- ✅ 移除了 `UserJobProof` 和 `AcademicHonor` 实体类中不存在的 `remarks` 字段
- ✅ 保留了关联查询字段 `jobTitle` 和 `companyName`（使用 `@TableField(exist = false)`）

### 2. Service 层修复
- ✅ 修复了 `AcademicHonorService.uploadHonor()` 方法，支持 `awardLevel` 和 `awardDate` 为空（符合数据库表结构）
- ✅ 添加了空值检查，确保返回空列表而不是 null
- ✅ 移除了对不存在的 `remarks` 字段的处理

### 3. Mapper XML 修复
- ✅ 移除了 `UserJobProofMapper.xml` 中对 `remarks` 字段的映射

## 接口列表

### 1. 兼职推荐相关接口

#### 1.1 获取兼职推荐列表
- **路径**: `GET /api/jobs/recommendations`
- **参数**: 
  - `city` (可选): 城市名称
  - `district` (可选): 区域名称
  - `jobType` (可选): 岗位类型
  - `status` (可选，默认 ACTIVE): 状态
- **返回**: 兼职岗位列表

#### 1.2 上传工作证明
- **路径**: `POST /api/jobs/proof`
- **请求体**:
```json
{
  "jobId": 1,                    // 可选，关联的兼职ID
  "proofType": "工作证明",        // 必填：工作证明/工资流水/劳动合同
  "proofUrl": "https://...",      // 必填，文件上传后的URL
  "monthlyIncome": 4500.00,      // 可选，月收入
  "startDate": "2024-01-01",     // 必填，开始日期
  "endDate": "2024-06-30",       // 可选，结束日期
  "remarks": "备注信息"           // 可选，备注说明（前端可传，但后端不保存）
}
```

#### 1.3 获取用户工作证明列表
- **路径**: `GET /api/jobs/proof`
- **返回**: 用户的工作证明列表（包含关联的兼职信息：jobTitle, companyName）

#### 1.4 删除工作证明
- **路径**: `DELETE /api/jobs/proof/{id}`
- **返回**: 删除成功

### 2. 学业荣誉相关接口

#### 2.1 上传学业荣誉证明
- **路径**: `POST /api/academic-honors`
- **请求体**:
```json
{
  "honorType": "奖学金",              // 必填：奖学金/竞赛获奖/优秀学生/科研成果/社会实践
  "honorName": "国家励志奖学金",       // 必填，荣誉名称
  "awardLevel": "国家级",              // 可选：国家级/省级/校级/院级
  "awardDate": "2024-01-01",          // 可选，获奖日期
  "certificateUrl": "https://...",     // 必填，证书文件URL
  "issuingOrganization": "教育部",     // 可选，颁发机构
  "remarks": "备注信息"                // 可选，备注说明（前端可传，但后端不保存）
}
```

#### 2.2 获取用户学业荣誉列表
- **路径**: `GET /api/academic-honors`
- **返回**: 用户的学业荣誉列表

#### 2.3 删除学业荣誉
- **路径**: `DELETE /api/academic-honors/{id}`
- **返回**: 删除成功

### 3. 用户位置相关接口

#### 3.1 获取用户位置信息
- **路径**: `GET /api/user/location`
- **返回**: 用户的位置信息（用于兼职推荐时自动填充城市）

## 初始化测试数据

为了确保前端调用时有数据返回，请执行以下 SQL 文件初始化测试数据：

```bash
# 执行初始化数据脚本
mysql -u root -p travel_loan < src/main/resources/init_repayment_capacity_data.sql
```

或者在 MySQL 客户端中执行：
```sql
USE travel_loan;
SOURCE src/main/resources/init_repayment_capacity_data.sql;
```

**注意**: 
- `init_repayment_capacity_data.sql` 文件会插入 10 条兼职岗位测试数据
- 用户工作证明和学业荣誉的测试数据需要根据实际用户ID插入（文件中已提供示例）

## 数据库表结构说明

### user_job_proof 表
- ✅ 不包含 `remarks` 字段（已从实体类中移除）
- ✅ 包含关联查询字段 `jobTitle` 和 `companyName`（不映射到数据库）

### academic_honor 表
- ✅ `award_level` 和 `award_date` 可以为 NULL（Service 已支持）
- ✅ 不包含 `remarks` 字段（已从实体类中移除）

## 接口测试建议

### 1. 测试获取兼职推荐列表
```bash
curl -X GET "http://localhost:8080/api/jobs/recommendations?city=北京市&jobType=餐饮服务" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 测试上传工作证明
```bash
curl -X POST "http://localhost:8080/api/jobs/proof" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "jobId": 1,
    "proofType": "工作证明",
    "proofUrl": "https://example.com/proof.jpg",
    "monthlyIncome": 4500.00,
    "startDate": "2024-01-01",
    "endDate": "2024-06-30"
  }'
```

### 3. 测试获取用户工作证明列表
```bash
curl -X GET "http://localhost:8080/api/jobs/proof" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. 测试上传学业荣誉
```bash
curl -X POST "http://localhost:8080/api/academic-honors" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "honorType": "奖学金",
    "honorName": "国家励志奖学金",
    "awardLevel": "国家级",
    "awardDate": "2024-01-01",
    "certificateUrl": "https://example.com/cert.jpg",
    "issuingOrganization": "教育部"
  }'
```

## 注意事项

1. **所有接口都需要 JWT 认证**，请在请求头中添加 `Authorization: Bearer YOUR_TOKEN`
2. **文件上传**：工作证明和学业荣誉的文件需要先通过 `/api/upload` 接口上传，获取 URL 后再调用相应接口
3. **空值处理**：所有列表接口在没有数据时会返回空数组 `[]`，不会返回 null
4. **字段可选性**：
   - `awardLevel` 和 `awardDate` 可以为空（符合数据库表结构）
   - `endDate` 可以为空
   - `monthlyIncome` 可以为空
   - `issuingOrganization` 可以为空

## 前端调用示例

前端代码已经正确配置了所有接口路径，确保：
- ✅ 接口路径正确：`/api/jobs/...` 和 `/api/academic-honors`
- ✅ 请求头包含 JWT Token
- ✅ 错误处理完善
- ✅ 空数据处理正确（使用 `|| []` 确保不会报错）

## 后续优化建议

1. 如果需要支持 `remarks` 字段，需要先执行 ALTER TABLE 添加字段
2. 可以考虑添加分页功能
3. 可以考虑添加搜索功能
4. 可以考虑添加数据统计接口

